<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CONVERTIDOR AVISOS PDF</title>

<!-- Librer√≠as -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>

body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background: linear-gradient(135deg, #001f3f, #013a63, #014f86);
  color: #000;
}

h1, h2 {
  text-align: center;
  color: #fff;
  font-size: 26px;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 25px;
  text-shadow: 0 0 8px rgba(0,0,0,0.3);
}

#textoInforme {
  width: 80%;
  height: 200px;
  margin: 0 auto 20px auto;
  padding: 12px;
  font-family: Arial, sans-serif;
  font-size: 14px;
  border: 2px solid #014f86;
  border-radius: 10px;
  background: #fff;
  color: #000;
  resize: none;
  box-shadow: inset 0 0 6px rgba(0,0,0,0.4);
  display: block;
}

button {
  margin: 10px 5px;
  padding: 12px 20px;
  font-weight: bold;
  font-size: 15px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 3px 6px rgba(0,0,0,0.3);
}

button:hover { transform: translateY(-2 px); }

.btn-vista { background: #00b4d8; color: #001f3f; }
.btn-vista:hover { background: #90e0ef; }

.btn-pdf { background: #e63946; color: #fff; }
.btn-pdf:hover { background: #ff5c66; }

.btn-reiniciar { background: #2a9d8f; color: #fff; }
.btn-reiniciar:hover { background: #52b2a5; }

#vistaPrevia {
  width: 210mm;
  min-height: 297mm;
  background: #fff;
  color: #000;
  margin: 30px auto;
  padding: 20mm 30mm 20mm 30mm;
  font-family: Arial, sans-serif;
  font-size: 12pt; /* üëà ESTE ES EL ‚ÄúARIAL 12‚Äù */
  line-height: 1.35;
  text-align: justify;
}

.encabezado-principal {
    font-size: 17pt;               /* Tama√±o m√°s estable para subrayado */
    font-weight: 700;              /* Negrita firme */
    text-align: center;
    text-transform: uppercase;
    color: #000;
    margin: 0 0 8px 0;
    display: inline-block;         /* Clave ‚Üí subrayado perfecto */
    width: 100%;
    text-decoration: underline;
    text-decoration-thickness: 2px;   /* Grosor del subrayado */
    text-underline-offset: 10px;       /* ‚Üê BAJA el subrayado */
}


footer { text-align: center; color: #e0e0e0; font-size: 13px; margin-top: 40px; letter-spacing: 0.5px; opacity: 0.85; }
footer span { font-weight: bold; color: #90e0ef; font-size: 16px; }

.config input#nombrePDF {
  width: 250px;
  padding: 12px 16px;
  font-size: 14pt;
  font-weight: 500;
  border: 2px solid #f0c987;
  border-radius: 12px;
  outline: none;
  background: #fff8e7;
  color: #4a4a4a;
  box-shadow: 0 4px 8px rgba(0,0,0,0.08);
  transition: all 0.3s ease-in-out;
}

.config input#nombrePDF:focus {
  border-color: #f7b733;
  background: #fff3d6;
  box-shadow: 0 6px 12px rgba(0,0,0,0.12); 
}

.config.oculta { display: none; }

/* Negrita suave para TODO el documento */
b, .negrita {
    font-weight: 600 !important;  
    letter-spacing: 0px;
}

/* ====== ESTILO DE P√ÅGINA PREDETERMINADO ====== */

.pagina {
  width: 210mm;
  min-height: 280mm;
  background: white;
  margin: 0 auto;
  padding: 25mm 20mm 20mm 20mm;
  position: relative;
  box-shadow: 0 0 8px rgba(0,0,0,0.15);
}

/* CABECERA FIJA */
.cabecera-predeterminada {
  position: absolute;
  top: 10mm;
  left: 0;
  width: 100%;
  text-align: center;
  font-size: 12pt;
  font-weight: bold;
  text-transform: uppercase;
  color: #000;
}

/* L√çNEA BAJO CABECERA */
.cabecera-linea {
  width: 100%;
  height: 2px;
  background: #000;
  margin: 5px auto 0 auto;
}

/* PIE FIJO */
.pie-pagina {
  position: absolute;
  bottom: 15mm;
  right: 30mm;      /* üëâ Lo mueve hacia la derecha */
  width: auto;      /* üëâ Para que no ocupe todo el ancho */
  text-align: right;
  font-size: 10pt;
  color: #555;
}


/* === NUEVA CABECERA DIVIDIDA === */

.cabecera-contenedor {
  position: absolute;
  top: 10mm;
  left: 0;
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 15mm;
}

.cabecera-izquierda {
    text-align: center;
    width: 40%;
}

.cabecera-titulo {
  font-size: 14pt;
  font-weight: bold;
  text-transform: uppercase;
  color: #000;
}

.cabecera-sub {
  font-size: 11pt;
  color: #000;
  margin-top: 3px;
  line-height: 1.2;
}

.cabecera-derecha {
  width: 40mm;
  height: auto;
  text-align: right;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  margin-top: -4mm;   /* S√∫belo lo que necesites */
}

.cabecera-derecha img {
  max-width: 40mm;
  height: auto;
  margin-right: 50mm;   /* MOVER hacia la izquierda */
}
 
.enlace {
    color: #0000EE;      /* Azul cl√°sico de hiperenlace */
    text-decoration: underline;
    font-weight: 500;    /* Negrita suave */
}


.peque {
    font-size: 12pt;        /* tama√±o reducido */
    font-weight: bold;     /* negrita */
}

.titulo-subrayado { 
    font-size: 18pt; /* Se ajusta al Tama√±o del texto */
    font-weight: 700;
    text-align: center;
    text-transform: uppercase;
    display: inline-block;     /* Se ajusta al ancho del texto */
    margin: 35px auto 25px auto;

    border-bottom: 2px solid #000;
    padding-bottom: 1px;      /* Baja la l√≠nea */
}





</style>
</head>

<body><h1>Convertidor de AVISOS a PDF</h1>
<h2>(MAL TIEMPO, TEMPORAL, ESPECIAL, ETC.)</h2>

<textarea id="textoInforme" placeholder="Pega aqu√≠ tu informe meteorol√≥gico en may√∫sculas..."></textarea>

<div class="config" style="text-align:center; margin-bottom:20px;">
  <label style="font-weight:bold; font-size:14pt; color:#fff;">Nombre sugerido para PDF:</label><br>
  <input type="text" id="nombrePDF" placeholder="Ej: Informe_Meteorologico">
</div>

<div style="text-align:center;">
  <button class="btn-vista" onclick="generarVista()">üîç Ver vista previa</button>
  <button class="btn-pdf" onclick="generarPDF()">üìÑ Generar PDF</button>
  <button class="btn-reiniciar" onclick="reiniciar()">üîÑ Reiniciar</button>
</div>

<div id="vistaPrevia" class="pagina">

    <div class="cabecera-contenedor">
        <div class="cabecera-izquierda">
            <div class="cabecera-titulo">Armada de Chile</div>
            <div class="cabecera-sub">Comandante en Jefe V Zona Naval</div>
            <div class="cabecera-sub">Gobernaci√≥n Mar√≠tima de Puerto Montt</div>
            <div class="cabecera-sub">Centro Meteorol√≥gico Mar√≠timo PMO.</div>
        </div>

        <div class="cabecera-derecha">
            <!-- Aqu√≠ puedes colocar un escudo -->
            <img src="https://archive.org/download/logo-servimet-transparente/LOGO_SERVIMET_TRANSPARENTE.png" id="escudo" alt="ESCUDO" style="width:20mm; height:auto; opacity:1.0;">
        </div>
    </div>

    <div id="contenidoPagina" style="margin-top:20mm;"></div>

    <div class="pie-pagina">

<div class="cabecera-sub peque">CENTRO METEOROL√ìGICO MAR√çTIMO DE PUERTO MONTT</div>


<div class="cabecera-sub">
    <span class="enlace">http://meteoarmada.directemar.cl</span>  //
    <span class="enlace">@MetArmada_Pmo</span>
</div>

            <div class="cabecera-sub">AVENIDA ANGELM√ì 2201, PUERTO MONTT</div>
            <div class="cabecera-sub">TEL: (65) 2205174 - 2205123</div>

    </div>
</div>


<footer>
  Creado por <span>Cabo 2¬∫ (Met.) Francisco Salas Mu√±oz</span>
</footer>

<script>

// MAY√öSCULAS
function todoMayusculas(texto) {
  return texto.toUpperCase();
}

// ‚úî NEGRITAS A B C D + PRONOSTICO corregido
function aplicarNegritasEspeciales(html) {

    // A.- y D.- hasta el primer punto
    html = html.replace(/(^|<br>)(A\.-[\s\S]*?\.)/g, "$1<b>$2</b>");
    html = html.replace(/(^|<br>)(D\.-[\s\S]*?\.)/g, "$1<b>$2</b>");

    // B.- y C.- hasta los dos puntos
    html = html.replace(/(^|<br>)(B\.-[\s\S]*?:)/g, "$1<b>$2</b>");
    html = html.replace(/(^|<br>)(C\.-[\s\S]*?:)/g, "$1<b>$2</b>");

    // ‚≠ê‚≠ê‚≠ê SOLUCI√ìN DEFINITIVA PARA C.- PRONOSTICO ‚≠ê‚≠ê‚≠ê
    // Captura C.- PRONOSTICO:
    // y TODO lo que est√© inmediatamente abajo (sin importar c√≥mo se gener√≥ la l√≠nea)
    // hasta el primer punto REAL.
    html = html.replace(
        /(C\.\-\s*PRONOSTICO:\s*)([\s\S]*?\.)(?=\s|<br>|$)/i,
        "<b>$1$2</b>"
    );

    // ‚≠ê EMITIDO: EN NEGRITA ‚≠ê
    html = html.replace(/(EMITIDO:)/g, "<b>$1</b>");

    return html;
}

function generarVista(){
  let texto = document.getElementById("textoInforme").value.trim();
  if(!texto){ alert("Por favor, pega el texto del informe meteorol√≥gico."); return; }

  texto = todoMayusculas(texto);

  const lineas = texto.split("\n");

let primeraLinea =
  `<div style="text-align:center;">
      <div class="titulo-subrayado">${lineas[0]}</div>
   </div>`;




  let espacios = `<div style="height:20px;"></div>`;

  const resto = lineas.slice(1).join("\n");

  let html = resto.replace(/\n/g, "<br>");

  html = aplicarNegritasEspeciales(html);

document.getElementById("contenidoPagina").innerHTML =
    `${primeraLinea}${espacios}${html}`;

}

async function generarPDF() {
  const { jsPDF } = window.jspdf;
  const vista = document.getElementById("vistaPrevia");

const canvas = await html2canvas(vista, { 
    scale: 1.2, 
    backgroundColor: "#ffffff",
    useCORS: true 
});

  const imgData = canvas.toDataURL("image/png");
  const pdf = new jsPDF("p", "mm", "letter");

  const pageWidth = 216;
  const imgWidth = 210;
  const imgHeight = (canvas.height * imgWidth) / canvas.width;

  const nombreArchivo = document.getElementById("nombrePDF").value.trim() || "Informe_Meteorologico";
  pdf.addImage(imgData, "PNG", (pageWidth - imgWidth) / 2, 10, imgWidth, imgHeight);
  pdf.save(nombreArchivo + ".pdf");
}

function reiniciar(){
  document.getElementById("textoInforme").value = "";
  document.getElementById("vistaPrevia").innerHTML = "";
  document.getElementById("nombrePDF").value = "";
}

</script>
</body>
</html>

